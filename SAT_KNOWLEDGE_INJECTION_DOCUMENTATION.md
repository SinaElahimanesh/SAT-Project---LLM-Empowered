# تزریق دانش تکنیک دلبستگی به خود (SAT) به تمام پرامپت‌ها

## خلاصه اجرا

این پروژه دانش جامع تکنیک دلبستگی به خود (Self-Attachment Technique - SAT) را به تمام پرامپت‌های مورد استفاده در مراحل مختلف چت‌بات تزریق کرده است. این کار باعث می‌شود که چت‌بات در تمام مراحل دارای دانش کامل درباره SAT باشد و بتواند به سوالات مربوط به این تکنیک پاسخ دهد.

## فایل‌های ایجاد شده

### 1. دانش پایه SAT
**فایل:** `backend/api/bot/RAG/sat_knowledge_base.md`

این فایل شامل:
- تعریف کامل تکنیک دلبستگی به خود (SAT)
- اساس نظری و علمی SAT
- مراحل و تمرین‌های مختلف SAT
- اصول کلیدی و کاربردهای بالینی
- نکات مهم برای اجرا

## تغییرات اعمال شده

### 1. تغییرات در `utils.py`

#### الف) اضافه کردن متد `_load_sat_knowledge()`
```python
def _load_sat_knowledge(self):
    """Load SAT knowledge base for injection into prompts"""
    try:
        with open('api/bot/RAG/sat_knowledge_base.md', "r", encoding="utf-8") as file:
            return file.read()
    except FileNotFoundError:
        return "دانش پایه SAT در دسترس نیست."
```

#### ب) تغییر متد `ask_llm()`
- تزریق خودکار دانش SAT به تمام پرامپت‌ها
- اضافه کردن بخش "📚 دانش پایه تکنیک دلبستگی به خود (SAT)" به تمام پرامپت‌ها

#### ج) تغییر متد `customize_excercises()`
- تزریق دانش SAT به پرامپت‌های تمرین

### 2. به‌روزرسانی پرامپت‌های مختلف

#### الف) پرامپت‌های اصلی:
- `greeting_formality_name.md` - اضافه کردن دانش تخصصی SAT
- `emotion.md` - اضافه کردن دانش تنظیم هیجان در SAT
- `event.md` - اضافه کردن دانش حل مشکلات در SAT
- `open_ended_conversation.md` - اضافه کردن دانش گفتگوی آزاد در SAT

#### ب) پرامپت‌های تمرین:
- `suggestion.md` - اضافه کردن دانش تخصصی تمرینات SAT
- `exercise_explanation.md` - اضافه کردن دانش توضیح تمرینات SAT
- `ask_exercise.md` - اضافه کردن دانش پیشنهاد تمرینات SAT
- `like_to_do_another_exc.md` - اضافه کردن دانش تمرینات اضافی SAT
- `feedback.md` - اضافه کردن دانش بازخورد تمرینات SAT

## محتوای دانش تزریق شده

### 1. دانش پایه SAT
- تعریف و اساس نظری
- هدف اصلی و مکانیزم عمل
- پشتوانه علمی (مدل‌های ریاضی و محاسباتی)

### 2. مراحل و تمرین‌های SAT
- **مرحله ابتدایی**: تمرینات 1-8a
- **مرحله میانی**: تمرینات 8b-19
- **مرحله پیشرفته**: تمرینات 11-21

### 3. اصول کلیدی
- پیوند با خود کودکی
- تنظیم هیجان
- خود-مراقبتی
- حل آسیب‌های گذشته
- انعطاف‌پذیری شناختی

### 4. کاربردهای بالینی
- شرایط مناسب
- مزایای درمانی
- نکات مهم برای اجرا

## مزایای پیاده‌سازی

### 1. دانش جامع
- تمام پرامپت‌ها اکنون دارای دانش کامل SAT هستند
- چت‌بات می‌تواند به سوالات تخصصی درباره SAT پاسخ دهد

### 2. یکپارچگی
- دانش SAT در تمام مراحل در دسترس است
- پاسخ‌ها هماهنگ و منسجم هستند

### 3. انعطاف‌پذیری
- دانش به صورت خودکار تزریق می‌شود
- امکان به‌روزرسانی آسان دانش پایه

### 4. تخصصی‌سازی
- هر پرامپت دارای دانش تخصصی مربوط به مرحله خود است
- پاسخ‌ها متناسب با نیاز هر مرحله هستند

## نحوه عملکرد

### 1. تزریق خودکار
هر بار که پرامپتی استفاده می‌شود، دانش SAT به صورت خودکار تزریق می‌شود:

```python
# در متد ask_llm
sat_knowledge = self._load_sat_knowledge()
sat_knowledge_section = f"\n\n### 📚 دانش پایه تکنیک دلبستگی به خود (SAT):\n{sat_knowledge}\n"
system_prompt += sat_knowledge_section
```

### 2. دانش تخصصی
هر پرامپت علاوه بر دانش پایه، دارای دانش تخصصی مربوط به مرحله خود است:

- **پرامپت‌های اصلی**: دانش کلی SAT
- **پرامپت‌های تمرین**: دانش تخصصی تمرینات
- **پرامپت‌های هیجان**: دانش تنظیم هیجان
- **پرامپت‌های مشکل**: دانش حل مشکلات

## نکات مهم

### 1. حفظ هدف اصلی
- دانش SAT به عنوان اطلاعات اضافی تزریق شده است
- هدف اصلی هیچ پرامپتی تغییر نکرده است
- عملکرد اصلی چت‌بات حفظ شده است

### 2. انعطاف‌پذیری
- دانش SAT در صورت عدم دسترسی به فایل، پیام مناسب نمایش می‌دهد
- امکان به‌روزرسانی دانش پایه بدون تغییر کد

### 3. کارایی
- دانش فقط یک بار در هر درخواست بارگذاری می‌شود
- تأثیر منفی بر عملکرد سیستم ندارد

## نتیجه‌گیری

این پیاده‌سازی باعث می‌شود که چت‌بات در تمام مراحل دارای دانش جامع و تخصصی درباره تکنیک دلبستگی به خود (SAT) باشد. این کار باعث بهبود کیفیت پاسخ‌ها و توانایی پاسخگویی به سوالات تخصصی درباره SAT می‌شود، در حالی که هدف اصلی و عملکرد چت‌بات حفظ می‌شود.

## فایل‌های تأثیرپذیر

### فایل‌های اصلی:
- `backend/api/bot/utils.py` - تغییرات در متدهای اصلی (Main Bot - Alpha)
- `backend/api/bot/simple_bot.py` - تغییرات در متدهای اصلی (Simple Bot - Beta)
- `backend/api/bot/RAG/sat_knowledge_base.md` - دانش پایه جدید

### پرامپت‌های به‌روزرسانی شده:
- `greeting_formality_name.md`
- `emotion.md`
- `event.md`
- `open_ended_conversation.md`
- `suggestion.md`
- `exercise_explanation.md`
- `ask_exercise.md`
- `like_to_do_another_exc.md`
- `feedback.md`
- `simple_fsm_full.md` - پرامپت اصلی Simple Bot

## تأیید دسترسی دانش SAT

### ✅ Main Bot (Alpha):
- **فایل**: `backend/api/bot/utils.py`
- **متد**: `ask_llm()` و `customize_excercises()`
- **وضعیت**: دانش SAT تزریق شده ✅

### ✅ Simple Bot (Beta):
- **فایل**: `backend/api/bot/simple_bot.py`
- **متد**: `simple_bot_response()`
- **وضعیت**: دانش SAT تزریق شده ✅

### ✅ دانش پایه SAT:
- **فایل**: `backend/api/bot/RAG/sat_knowledge_base.md`
- **محتوای**: فقط اطلاعات ارائه شده توسط کاربر
- **وضعیت**: بدون محتوای تولید شده اضافی ✅

این پیاده‌سازی به صورت کامل و جامع دانش SAT را در تمام مراحل چت‌بات (هم Alpha و هم Beta) تزریق کرده و آماده استفاده است.
